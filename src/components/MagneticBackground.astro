---

---

<div id="magnetic-background" class="fixed inset-0 -z-10">
  <canvas id="magnetic-canvas"></canvas>
</div>

<script>
  import { magneticBackgroundStore } from '../stores/magneticBackgroundStore'

  function initBackground() {
    const canvas = document.getElementById(
      'magnetic-canvas',
    ) as HTMLCanvasElement
    if (canvas) {
      magneticBackgroundStore.init(canvas)
    }
  }

  // Initialize on page load
  if (document.readyState === 'complete') {
    initBackground()
  } else {
    document.addEventListener('DOMContentLoaded', initBackground)
  }

  // Ensure the background persists during route changes
  document.addEventListener('astro:before-swap', (event) => {
    const magneticBackgroundElement = document.getElementById(
      'magnetic-background',
    )
    if (magneticBackgroundElement) {
      event.preventDefault()
    }
  })

  // Update canvas reference after route changes
  document.addEventListener('astro:after-swap', () => {
    const canvas = document.getElementById(
      'magnetic-canvas',
    ) as HTMLCanvasElement
    if (canvas) {
      magneticBackgroundStore.subscribe((background: any) => {
        if (background && 'updateCanvas' in background) {
          background.updateCanvas(canvas)
        }
      })()
    }
  })
</script>

<style>
  #magnetic-background {
    pointer-events: none;
  }
  #magnetic-canvas {
    width: 100%;
    height: 100%;
  }
</style>
